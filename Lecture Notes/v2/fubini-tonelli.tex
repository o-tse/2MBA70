
In this chapter we will discuss how to turn two measure space into a new measure space by taking a \emph{product}. We will then consider integration on this product space and relate it to integration over the individual spaces. In particular, we will discuss several theorems that basically say that integrating a function $f(x,y)$ with respect to $(x,y)$ is the same as first integrating with respect to $x$ and then to $y$, or the other way around. In other words, the order does not matter.

\section{Product measures and independent random variables}
\label{se:product-measures}

Recall that in Chapter~\ref{chapter:sigma_algebras} we defined the notion of the product of two measurable spaces, see Definition~\ref{def:product_sigalg}. Later, in Chapter~\ref{chapter:measurable_functions} we gave a alternative definition using the \sigalg/ generated by projections, see~\eqref{eq:product_sigalg_equivalence}. 

Given that we can take two measurable space $(\Omega_1, \cF_1)$ and $(\Omega_2, \cF_2)$ and turn them into a new space, by taking a ``product", can we do the same for two measure spaces $(\Omega_1, \cF_1, \mu_1)$ and $(\Omega_2, \cF_2, \mu_2)$? Here of course we would like to have our product measure relate to measures $\mu_1$ and $\mu_2$. One natural case would be that $\mu_1 \otimes \mu_2 (A \times B) =\mu_1(A) \mu_2(B)$, for all $A \in \cF_1$ and $B \in \cF_2$. However, it is not obvious how to explicitly define a measure on the entire product sigma-algebra such that this property holds.  

Luckily, the following theorem states that such a measure does exist. Moreover, if we assume the spaces $(\Omega_i, \cF_i, \mu_i)$ to be $\sigma$-finite the product measure is actually the unique measure with this property. 

%It does require one small condition on the individual measure spaces. Recall that a measure space $(\Omega, \cF, \mu)$ is called $\sigma$-finite if there exist a growing sequence $(A_n)_{n \ge 1}$ of measurable sets such that $\bigcup_{n \ge 1} A_n = \Omega$ and $\mu(A_n) < \infty$ holds for all $n \ge 1$. 

\begin{theorem}[Construction of product measure space]
	\label{th:construction-product-measure}
	Let $(\Omega_i, \cF_i, \mu_i)$, for $i = 1, 2$,  be two $\sigma$-finite measure spaces. Let $\cF_1 \otimes \cF_2$ denote the product $\sigma$-algebra. 
	Then there exists a unique complete measure $\mu_1 \otimes \mu_2$ on 
	$(\Omega_1 \times \Omega_2, \overline{\cF_1 \otimes \cF_2})$ such that 
	\[
	(\mu_1 \otimes \mu_2)(A \times B ) = \mu_1(A) \cdot \mu_2(B)
	\]
	for all $A \in \cF_1$ and $B \in \cF_2$.
\end{theorem}

\begin{proof}
Recall that $\cF_1 \otimes \cF_2 = \sigma(\cF_1 \times \cF_2)$, where $\cF_1 \times \cF_2 := \{A \times B \, : \, A \in \cF_1, B \in \cF_2\}$.

The idea of the proof is to use the Carath\'{e}odory Extension theorem (Theorem~\ref{thm:caratheodory}). For this we need to show two things:
\begin{enumerate}
\item The collection $\cF_1 \times \cF_2$ is a semi-algebra, and
\item the set function $\mu : \cF_1 \times \cF_2 \to [0,\infty]$ defined by $\mu(A \times B) = \mu_1(A) \mu_2(B)$ is a pre-measure on $\cF_1 \times \cF_2$.
\end{enumerate}

Once we have proven these two properties, the result follows immediately from Theorem~\ref{thm:caratheodory}.

The first part is left as an exercise, see Problem~\ref{prb:construction-product-measure}. So let us focus on the second part. It is clear that $\mu(\emptyset) = 0$ and thus we only need to show that $\mu$ is $\sigma$-additive on $\cF_1 \times \cF_2$. To this end, let $(A_i \times B_i)_{i \ge 1}$ be a family of disjoint sets in $\cF_1 \times \cF_2$ such that $\bigcup_{i \ge 1} A_i \times B_i = A \times B \in \cF_1 \times \cF_2$. We then have to show that
\[
	\mu(A \times B) = \sum_{i \ge 1} \mu_1(A_i) \mu_2(B_i).
\]

For this we will consider the indicator functions of the sets and use monotone convergence. 

First observe that
\begin{equation}\label{eq:product_spaces_main}
	\mathbbm{1}_{A} \mathbbm{1}_{B} = \mathbbm{1}_{A \times B} 
	= \sum_{i \ge 1} \mathbbm{1}_{A_i \times B_i} = \sum_{i \ge 1} \mathbbm{1}_{A_i} \mathbbm{1}_{B_i}.
\end{equation}
Now fix some $\omega_1 \in \Omega_1$ and define the function $f : \Omega_2 \to \{0,1\}$ as $f(\omega) = \mathbbm{1}_{A}(\omega_1) \mathbbm{1}_{B}(\omega)$. Then $f$ is measurable and integrable and for the integral we have
\[
	\int_{\Omega_2} f \, \dd \mu_2 = \mathbbm{1}_{A}(\omega_1) \mu_2(B).
\]
Since the function $g(\omega) = \mathbbm{1}_{A}(\omega) \mu_2(B)$ is again integrable we get that
\[
	\int_{\Omega_1} g \, \dd \mu_1 = \mu_1(A) \mu_2(B).
\]
We thus conclude that
\[
	\mu(A \times B) = \int_{\Omega_1} \left(\int_{\Omega_2} \mathbbm{1}_{A} \mathbbm{1}_{B} \right) \, \dd \mu_1.
\]
We now need to show that by first integrating the right hand side in~\eqref{eq:product_spaces_main} with respect to $\mu_2$ and then $\mu_1$ gives us $\sum_{i \ge 1} \mu_1(A_i) \mu_2(B_i)$.

For this we again fix a $\omega_1 \in \Omega_1$ and now consider the function $f_n : \Omega_2 \to \{0,1\}$, defined by $f_n(\omega) = \sum_{i = 1}^n \mathbbm{1}_{A_i \times B_i}(\omega_1, \omega)$ which is a measurable and integrable. Moreover, $(f_n)_{n \to \infty}$ is a monotone sequence of functions whose point-wise limit is 
\[
	\sum_{i \ge 1} \mathbbm{1}_{A_i}(\omega_1) \mathbbm{1}_{B_i}(\omega).
\]
Therefore, applying monotone convergence we get
\[
	\int_{\Omega_2} \sum_{i \ge 1} \mathbbm{1}_{A_i}(\omega_1) \mathbbm{1}_{B_i} \, \dd \mu_2 
	= \sum_{i \ge 1} \int_{\Omega_2} \mathbbm{1}_{A_i}(\omega_1) \mathbbm{1}_{B_i} \, \dd \mu_2 
	= \sum_{i \ge 1} \mathbbm{1}_{A_i}(\omega_1) \mu_2(B_i).
\]

For the final step we note that
\[
	\int_{\Omega_2} \sum_{i \ge 1} \mathbbm{1}_{A_i}(\omega_1) \mathbbm{1}_{B_i} \, \dd \mu_2 = 
	\int_{\Omega_2} \mathbbm{1}_A(\omega_1) \mathbbm{1}_B \, \dd \mu_2 = \mathbbm{1}_{A}(\omega_1)\mu_2(B),
\]
which is measurable and integrable. Thus integrating this function with respect to $\mu_1$ and using monotone convergence implies that
\[
	\int_{\Omega_1} \left(\int_{\Omega_2} \sum_{i \ge 1} \mathbbm{1}_{A_i} \mathbbm{1}_{B_i} \, \dd \mu_2\right) \, \dd \mu_1 = \sum_{i \ge 1} \mu_1(A_i) \mu_2(B_i)
\]
which finishes the proof.
\end{proof}


Suppose now we have two measures spaces $(\Omega_i, \cF_i, \mu_i)$ for $i = 1,2$ such that $\cF_i = \sigma(\cA_i)$, i.e. the \sigalgs/ are generated by some sets $\cA_i$. Then one might expect that the product $\cF_1 \otimes \cF_2$ is generated by $\cA_1 \times \cA_2$. This turns out to indeed be true

\begin{lemma}\label{lem:product_sigalgs_generators}
Let $(\Omega_i, \cF_i)$, for $i = 1, 2$,  be two measurable spaces, such that $\cF_i = \sigma(\cA_i)$ for some generator sets $\cA_1, \cA_2$. Suppose further there exists sequences $(A_n)_{n \ge 1}$ and $(B_m)_{m \ge 1}$ with $A_n \in \cA_1$, $B_m \in \cA_2$ and $\bigcup_{n \ge 1} A_n = \Omega_1$ and $\bigcup_{m \ge 1} B_m = \Omega_2$. Then
\[
	\sigma(\cA_1 \times \cA_2) = \sigma(\cF_1 \times \cF_2) = \cF_1 \otimes \cF_2
\] 
\end{lemma}

\begin{proof}
See Problem~\ref{prb:product_sigalgs_generators}.
\end{proof}

This lemma is very useful because it allows us to analyze product measure $\mu_1 \otimes \mu_2$ by only considering their values on sets from $\cA_1 \times \cA_2$. This is what we were already used to for general measures.

\section{Fubini's Theorem and Tonelli's Theorem}

Now that we can construct product measure spaces we take a closer look at integration with respect to the product measure, and how it relates to integration with respect to the marginal measures. In particular, we will present four versions of a very similar statement, which basically states that in order to integrate over a product measure space, one may use iterated integration on each of the marginal measures, and one may also change the order of integration. This is very similar to what you have seen for Riemann integration. To illustrate that this is not obvious, consider the following example.

\begin{example}
	Let $f: [0,1]\times[0,1] \to \bbR$ be continuous. Then  
	\[
	\int_{[0,1]\times[0,1]} f\, \dd A = \int_0^1\!\! \int_0^1 f(x,y)\, \dd x\, \dd y = \int_0^1\!\! \int_0^1 f(x,y)\, \dd y \,\dd x.
	\]	
\end{example}

In the example above, the left-hand side can either be interpreted as the two-dimensional Riemann integral or the integral against the two-dimensional Lebesgue measure. Since $f$ is continuous, we know (see Theorem~\ref{thm:riem-leb}) that these integrals agree. However, the two integrals to the right of this two-dimensional integral are different. Consider the first:
\[
	\int_0^1\!\! \int_0^1 f(x,y)\, \dd x\, \dd y.
\]
This can be seen as the one-dimensional integral of the function $y \mapsto \int_0^1 f(x,y)\, \dd x$. However, it is not clear at all whether this function is measurable. Moreover, why would the one-dimensional Lebesgue integral of this function be the same as the one-dimensional Lebesgue integral of $x \mapsto \int_0^1 f(x,y)\, \dd y$? These are exactly the kind of statements the four theorems we will discuss next cover.

Four versions sound excessive, but we will see that each of them has some satisfactory, and some unsatisfactory aspects to them. This will provide at least some justification for the amount of variation we shall cover. We only present the statements of the theorems as the proof is of a technical nature that does not teach us anything useful. The interested student can look up the proofs in [REF].

The first result is the so-caled Fubini's theorem:

\begin{theorem}[Fubini, version for non-complete measure spaces]
Let $(\Omega_i, \cF_i, \mu_i)$, $i=1,2$ be two measure spaces. 
Let $f : \Omega_1 \times \Omega_2 \to \overline{\bbR}$ be integrable on the product space $(\Omega_1 \times \Omega_2, \cF_1 \otimes \cF_2, \mu_1 \otimes \mu_2)$. Then, for every $x \in \Omega_1$, the function $y \mapsto f(x, y)$ is $(\cF_2,\cB_{\overline\bbR})$-measurable. Moreover, the function 
\[
x \mapsto \int_{\Omega_2} f(x,y)\,  \mu_2(\dd y)
\]
is $(\cF_1,\cB_{\overline\bbR})$-measurable and
\[
\begin{split}
\int_{\Omega_1 \times \Omega_2} f\, \dd \mu_1 \otimes \mu_2 
&= \int_{\Omega_1} \left( \int_{\Omega_2 } f(x,  y ) \,\mu_2(\dd y) \right) \mu_1(\dd x)\\
&= \int_{\Omega_2} \left( \int_{\Omega_1} f(x, y) \, \mu_1(\dd x) \right) \mu_2(\dd y).
\end{split}
\] 
\end{theorem}

Checking whether you can apply Fubini's theorem usually comes with (at least) two difficulties. First, you need to check that the function $f: \Omega_1 \times \Omega_2 \to \overline{\bbR}$ is measurable with respect to the product $\sigma$-algebra. This somehow falls into the category ``if some crazy procedure does not construct $f$, it is probably fine". What can at times be more difficult, is to check that $f$ is integrable. This is an important check, because if $f$ is not integrable, the conclusion of the theorem may not hold.

This second difficulty is somehow alleviated by Tonelli's theorem, stated next. Tonelli's theorem is about nonnegative functions, and does not assume integrability. It does need the additional assumption of $\sigma$-finiteness of the measure spaces.

\begin{theorem}[Tonelli, version for non-complete measure spaces]
	Let $(\Omega_i, \cF_i, \mu_i)$, $i=1,2$ be two $\sigma$-finite measure spaces. 
	Let $f : \Omega_1 \times \Omega_2 \to [0,+\infty]$ be measurable on the product space $(\Omega_1 \times \Omega_2, \cF_1 \otimes \cF_2, \mu_1 \otimes \mu_2)$. Then, for every $x \in \Omega_1$, the function $y \mapsto f(x, y)$ is $(\cF_2,\cB_{\overline\bbR})$-measurable. Moreover, the function 
	\[
	x \mapsto \int_{\Omega_2} f(x,y)\, \mu_2(\dd y)
	\]
	is $(\cF_1,\cB_{\overline\bbR})$-measurable and
	\[
	\begin{split}
	\int_{\Omega_1 \times \Omega_2} f\, \dd \mu_1 \otimes \mu_2 
	&= \int_{\Omega_1} \left( \int_{\Omega_2 } f(x,  y ) \,\mu_2(\dd y) \right) \mu_1(\dd x)\\
	&= \int_{\Omega_2} \left( \int_{\Omega_1} f(x, y)  \,\mu_1(\dd x) \right) \mu_2(\dd y).
	\end{split}
	\] 
\end{theorem}

While both the Fubini Theorem and the Tonelli theorem tell us that when integrating with respect to the product measures, the order does not matter, they are not yet as useful as you would like. For example, both have the annoying property, that they do not hold for the Lebesgue measure, since for instance the Lebesgue measure on $\bbR^2$ is not the product of the Lebesgue measures on $\bbR$ (why?). Instead, the Lebesgue measure is given as the completion of the product measure defined on the completion of the Borel \sigalg/. Luckily, there are versions of Fubini's and Tonelli's theorems for complete measure spaces. Recall that for a given measure space $(\Omega, \cF, \mu)$ we denote its completion by $(\Omega, \overline{\cF}, \overline{\mu})$.

\begin{theorem}[Fubini, version for complete measure spaces]
Let $(\Omega_i, \cF_i, \mu_i)$, $i=1,2$ be two complete measure spaces. 
Let $f : \Omega_1 \times \Omega_2 \to \overline{\bbR}$ be integrable on the product space $(\Omega_1 \times \Omega_2, \overline{\cF_1 \otimes \cF_2}, \overline{\mu_1 \otimes \mu_2})$. Then, for $\mu_1$-almost every $x \in \Omega_1$, the function $y \mapsto f(x, y)$ is $(\cF_2,\cB_{\overline\bbR})$-measurable. Moreover, the function 
\[
x \mapsto \int_{\Omega_2} f(x,y)\, \mu_2(\dd y)
\]
is $(\cF_1,\cB_{\overline\bbR})$-measurable and
\[
\begin{split}
\int_{\Omega_1 \times \Omega_2} f\, \dd \overline{\mu_1 \otimes \mu_2} 
&= \int_{\Omega_1} \left( \int_{\Omega_2 } f(x,  y ) \,\mu_2(\dd y) \right) \mu_1(\dd x)\\
&= \int_{\Omega_2} \left( \int_{\Omega_1} f(x, y) \,\mu_1(\dd x) \right) \mu_2(\dd y).
\end{split}
\] 	
\end{theorem}

Note that this version of Fubini's theorem assumes that the measure spaces involved are complete. 
Note also that the function $y \mapsto f(x,y)$ is in general no longer measurable for \emph{all} $x \in \Omega_1$. Just as the version of Fubini's theorem for not necessarily complete measures, the integrability of the function $f$ is assumed. Tonelli's theorem can sometimes be useful to establish this integrability.

\begin{theorem}[Tonelli, version for complete measure spaces]
	Let $(\Omega_i, \cF_i, \mu_i)$, $i=1,2$ be two complete, $\sigma$-finite, measure spaces. 
	Let $f : \Omega_1 \times \Omega_2 \to [0,+\infty]$ be measurable on the product space $(\Omega_1 \times \Omega_2, \overline{\cF_1 \otimes \cF_2}, \overline{\mu_1 \otimes \mu_2})$. Then, for $\mu_1$-almost every $x \in \Omega_1$, the function $y \mapsto f(x, y)$ is $(\cF_2,\cB_{\overline\bbR})$-measurable. Moreover, the function 
	\[
	x \mapsto \int_{\Omega_2} f(x,y)\, \dd \mu_2(y)
	\]
	is $(\cF_1,\cB_{\overline\bbR})$-measurable and
	\[
	\begin{split}
	\int_{\Omega_1 \times \Omega_2} f \,\dd \overline{\mu_1 \otimes \mu_2} 
	&= \int_{\Omega_1} \left( \int_{\Omega_2 } f(x,  y ) \,\mu_2(\dd y) \right) \mu_1(\dd x)\\
	&= \int_{\Omega_2} \left( \int_{\Omega_1} f(x, y)  \,\mu_1(\dd x) \right) \mu_2(\dd y).
	\end{split}
	\] 	
\end{theorem}

The takeaway of these four theorems is that if you have to integrate either with respect to the product measures or the completion of the product measures (as is the case for the Lebesgue measure) then, as long as your function is integrable (in the case of Fubini) or measurable (in the case of Tonelli), this can be done by iterative integration and the order does not matter.

%In the lecture, we will not go into the proofs of these theorems, because they are very technical. Just to be complete, I have included the proof in these lecture notes.

\section{Problems}

\begin{problem}\label{prb:construction-product-measure}
Let $(\Omega_1, \cF_1)$ and $(\Omega_2, \cF_2)$ be two measurable spaces and define 
\[
	\cF_1 \times \cF_2 := \{A \times B \, : \, A \in \cF_1, \, B \in \cF_2\}.
\]
Prove that $\cF_1 \times \cF_2$ is a semi-algebra (see Definition~\ref{def:semi_algebra}).
\end{problem}

\begin{problem}\label{prb:product_sigalgs_generators}
The goal of this exercise it to prove Lemma~\ref{lem:product_sigalgs_generators}.
\begin{enumerate}[label={(\alph*)}]
\item Show that $\sigma(\cA_1 \times \cA_2) \subset \cF_1 \otimes \cF_2$.
\item Consider the following family of sets
\[
	\Sigma_1 := \{C \in \cF_1 \, : \, C \times B \in \sigma(\cA_1 \times \cA_2) \, \forall B \in \cA_2\}.
\]
Prove that this is a \sigalg/ on $\Omega_1$.
\item Use this to prove that $\cF_1 \times \cA_2 \subset \sigma(\cA_1 \times \cA_2)$.
\item Explain how you can argue in a similar way that $\cA_1 \times \cF_2 \subset \sigma(\cA_1 \times \cA_2)$.
\item Finish the proof.
\end{enumerate}
\end{problem}

\begin{problem}
Take $d \in \bbN$ and let $(\Omega_i, \cF_i)_{1 \le i \le d}$ be $\sigma$-finite measurable spaces such that $\cF_i = \sigma(A_i)$. Show that
\[
	\cF_1 \otimes \dots \otimes \cF_d = \sigma(\cA_1 \times \dots \times \cA_d).
\]
\end{problem}

\begin{problem}
Let $(\bbR^d, \cB_{\bbR^d})$ be the $d$-dimensional Borel space. Prove that the \sigalg/ $\cB_{\bbR^d}$ is generated by any of the following family of sets:
\begin{enumerate}[label={(\alph*)}]
\item $\{(a_1, b_1) \times \dots \times (a_d,b_d)\}$,
\item $\{(a_1, b_1] \times \dots \times (a_d,b_d]\}$,
\item $\{[a_1, b_1) \times \dots \times [a_d,b_d)\}$,
\item $\{(-\infty,a_1] \times \dots \times (-\infty,a_d]\}$,
\item $\{(-\infty,a_1) \times \dots \times (-\infty, a_d)\}$,
\item $\{[a_1, \infty) \times \dots \times [a_d, \infty)\}$,
\item $\{(a_1,\infty) \times \dots \times (a_d, \infty)\}$,
\end{enumerate}
where $a_i, b_i \in \bbQ,$ or $a_i, b_i \in \bbR$ for all $i = 1, \dots, d$.
\end{problem}

