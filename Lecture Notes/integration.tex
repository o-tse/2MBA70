\section{The integral of a simple function}\label{sec:integral_simple_functions}

Let $(\Omega, \cF, \mu)$ be a measure space. 

\begin{definition}
	A function $f: \Omega \to \bbR$ is called \emph{simple} if it takes the form
	\[
	f = \sum_{i=1}^N a_i \mathbf{1}_{A_i}
	\]
	for some positive integer $N \in \bbN$, disjoint measurable sets $A_1, \ldots, A_N \in \cF$ and constants $a_1, \dots, a_N  \in \bbR$. For a non-negative simple function
\[
g = \sum_{i=1}^N a_i \mathbf{1}_{A_i},\qquad a_i\ge 0,
\]
we define the integral of $g$ with respect to $\mu$ by
\[
\int_\Omega g\, \dd \mu := \sum_{i = 1}^N a_i \mu(A_i).
\]
\end{definition}

A priori there could be different representations of the same simple function, so we should check that the integral of a simple function is well-defined. 
This follows, however, because $g$ actually has a unique representation 
\[
	g = \sum_{i=1}^M b_i \mathbf{1}_{B_i},\qquad \text{for which $b_i < b_{i+1}$}.
\]
By the finite additivity of the measure $\mu$,
\[
\sum_{i=1}^N a_i \mu(A_i) = \sum_{i=1}^M b_i \mu(B_i).
\]

\begin{remark}
	In case $(\Omega, \cF, \bbP)$ is a probability space, and $X$ is a simple, real-valued random variable on $\Omega$ having the representation
\[
	X = \sum_{i=1}^N a_i \mathbf{1}_{A_i},
\]
with mutually disjoint $A_i \in \cF$ and $a_i \in \bbR$, the integral is usually called the \emph{expectation} value of $X$ and is written as
\[
	\ex{X} := \int_\Omega X \dd \bbP = \sum_{i=1}^N a_i \prob{A_i}.
\]

\end{remark}

\section{The Lebesgue integral of nonnegative functions}

\begin{definition}
	Given a measurable function $f: (\Omega, \cF) \to ([0,+\infty],\cB_{[0,+\infty]})$, the \emph{$\mu$-integral of $f$ over $\Omega$} is defined by
\[
\int_\Omega f\, \dd \mu := \sup\left\{ \int_\Omega g\, \dd \mu : \ g \text{ simple},\; 0 \leq g  \leq f \right\}.
\]
\end{definition}

\begin{remark}
If $X$ is a nonnegative random variable on a probability space $(\Omega, \cF, \bbP)$, we call the integral the expectation value of $X$ and often write instead
\[
	\ex{X} := \int_\Omega X \dd \bbP.
\]
\end{remark}

For a measurable set $A \in \cF$, we use the following notation and definition for integration of $f$ over the set $A$
\[
	\int_A f\, \dd \mu := \int_\Omega \mathbf{1}_A\, f\, \dd \mu.
\]
If we denote by $f_A$ the restriction of $f$ to $A$, and by $\mu_A$ the restriction of $\mu$ to $\cF_A$, then 
\[
\int_A f_A\,\dd \mu_A = \int_A f\, \dd \mu.
\]
Similarly, if $f_A:(A, \cF_A) \to ([0,+\infty],\cB_{[0,+\infty]})$ is measurable, and $f$ is a measurable extension of $f_A$ to the whole of $\Omega$, then
\[
	\int_A f\,\dd \mu = \int_A f_A\, d \mu_A.
\]

\begin{proposition}[Properties of the Lebesgue integral of nonnegative functions]
	\label{pr:properties-integral-nonneg}
	Let $f$, $g$ be two nonnegative, measurable functions and $\lambda \geq 0$ be a constant.
	\begin{enumerate}
		\item (absolute continuity) If $B \in \cF$ satisfies $\mu(B) = 0$, then
		\[
		\int_{B} f\, \dd \mu = 0. 
		\]
		\item (monotonicity) If $f \leq g$, then
		\[
		\int_\Omega f\, \dd \mu \leq \int_\Omega g\, \dd \mu.
		\]
		\item (homogeneity)
		\[
		\lambda \int_\Omega f\, \dd \mu = \int_\Omega (\lambda f )\,\dd \mu.
		\]
	\end{enumerate}
\end{proposition}


\section{The monotone convergence theorem}
\label{sec:monotone_convergence}

\begin{theorem}[Monotone convergence theorem I]
	\label{th:monotone-convergence-I}
	Let $(\Omega, \cF, \mu)$ be a measure space. Let $f_n:(\Omega,\cF) \to ([0,+\infty],\cB_{[0,+\infty]})$, $n \in \bbN$, be a sequence of nonnegative measurable functions, such that $f_n(\omega) \leq f_{n+1}(\omega)$ for all $\omega \in \Omega$ and $n \in \bbN$. Define the function 
	\[
		f(\omega) := \lim_{n \to \infty} f_n(\omega),\qquad \omega\in\Omega.
	\]
	Then $f$ is measurable and
	\[
	\lim_{n \to \infty} \int_\Omega f_n\, \dd \mu = \int_\Omega f\, \dd \mu.
	\]
\end{theorem}

\begin{proof}
	From the monotonicity of the integral, we immediately conclude that
	\[
	\limsup_{n \to \infty} \int_\Omega f_n\, \dd \mu \leq \int_\Omega f\, \dd \mu.
	\]
	Hence, we are left to show that
	\[
	\liminf_{n \to \infty } \int_\Omega f_n\, \dd \mu \geq \int_\Omega f\, \dd \mu.
	\]
	This is obvious if $\int_\Omega f\, \dd \mu = 0$, so we assume that $\int_\Omega f\, \dd \mu >0$.
	
	By the definition of the integral, for every $0<\varepsilon<L$, there exists a nonnegative simple function $g: \Omega \to \bbR$ such that $0\le g \leq f$ on $\Omega$ and
	\[
		\int_\Omega g\, \dd \mu > \int_\Omega f\, \dd \mu - \varepsilon.
	\]
	Because $g$ is simple, there exist an $N \in \bbN$, nonnegative constants $a_i \in (0,\infty)$ and disjoint, measurable sets $A_i \in \cF$ such that
	\[
		g = \sum_{i=1}^N a_i \mathbf{1}_{A_i}.
	\]
	Moreover, we find some $\delta>0$, such that
	\[
		g_\delta:= \sum_{i=1}^N (a_i-\delta)\mathbf{1}_{A_i}, 
	\]
	satisfies
	\[
		\int_\Omega g_\delta\,\dd \mu = \sum_{i=1}^N(a_i-\delta)\,\mu(A_i) \ge \int_\Omega f\,\dd\mu - \varepsilon. 
	\]
	
	Now define for $i \in \{ 1, \dots, N\}$ and $n \in \bbN$ the measurable set
	\[
	G_n^i := \Bigl\{ x \in A_i : \ f_n(x) \geq a_i - \delta \Bigr\}.
	\]
	Then, because $f_n \leq f_{n+1}$, we have $G_n^i \subset G_{n+1}^i$ for all $n \in \bbN$ and by the pointwise convergence of $f_n$ to $f$, we have
	\[
	\bigcup_{n=1}^\infty G_n^i = A_i,\qquad i=1,\ldots,N.
	\]
	Hence, by the continuity from below of measures
	\[
		\lim_{n \to \infty}\mu(G_n^i) = \mu(A_i).
	\]
	Since for every $n\in\bbN$,
		\[
		\int_\Omega f_n\,\dd\mu \ge \sum_{i=1}^N \int_{A_i} f_n\,\dd \mu \ge \sum_{i=1}^N \int_{A_i} f_n\,\dd \mu \ge \sum_{i=1}^N \int_{G_n^i} f_n\,\dd \mu \ge \sum_{i=1}^N (a_i-\delta)\,\mu(G_n^i),
	\]
	we find that
	\[
		\liminf_{n \to \infty} \int_\Omega f_n\, \dd \mu \ge  \liminf_{n \to \infty } \sum_{i=1}^N (a_i - \delta) \mu(G_n^i) = \int_\Omega g_\delta\,\dd\mu \ge \int_\Omega f\,\dd\mu - \varepsilon. 
	\]
	Because $\varepsilon>0$ was arbitrary, it follows that
	\[
	\liminf_{n \to \infty} \int_\Omega f_n \dd \mu \geq \int_\Omega f \dd \mu.\qedhere
	\]	
\end{proof}

\section{Intermezzo: Approximation by simple functions}
\label{sec:simple-approximation}

In this section, we will give a few explicit approximations to arbitrary measurable functions. 
First consider a nonnegative measurable function $f : (\Omega, \cF) \to ([0,\infty], \cB_{[0,\infty]})$. We define the function $(f_n)_{n\in\bbN}$ by setting $f_n(\omega) = 0$ if $f(\omega) = 0$,
\[
	f_n(\omega) := k\, 2^{-n}\qquad \text{if}\quad f(\omega)\in [k\,2^{-n},(k+1)\,2^{-n}),
\]
for some $k \in \mathbb{N}\cup\{0\}$ and setting $f_n(\omega) = +\infty$ if $f(\omega) = +\infty$. Note that we can write
\[
	f_n = +\infty \mathbf{1}_{\{f=+\infty\}} + \sum_{k=0}^\infty k\, 2^{-n} \mathbf{1}_{\{k\,2^{-n}\le f < (k+1)\,2^{-n}\}} ,\qquad n\in\bbN
\]
and easily deduce that $f_n$ is measurable for every $n\in\bbN$.

The advantage of the approximation $f_n$ to $f$ is most clearly seen when $f(\omega) < +\infty$ for all $\omega \in \Omega$. In this case, $f_n$ converges to $f$ uniformly: In fact
\[
|f_n(\omega) - f(\omega)| \leq 2^{-n}
\]
for all $n \in \mathbb{N}$ and all $\omega \in \Omega$.

The disadvantage of the approximation $f_n$ is that if $f$ is unbounded, the approximation $f_n$ is not simple. To remedy this, we truncate $f_n$ to get the approximation
\[
	[f]_n := \min( 2^n, f_n ).
\]
The function $[f]_n$ is indeed simple.

Both the approximations $f_n$ and $[f]_n$ are nondecreasing in $n$. Moreover, they are pointwise approximations of the functions $f$. In particular, the function $f_n$ converges uniformly to $f$ on the set where $f$ is finite, and the functions $[f]_n$ converge uniformly to $f$ on any set on which $f$ is bounded.

\begin{problem}
	\label{prb:simple-approx-integral}
 Let $(\Omega, \cF, \mu)$ be a measure space and let $f: (\Omega,\cF) \to ([0,+\infty), \cB_{[0,+\infty)})$ be a nonnegative measurable function. Show that
\[
\int_\Omega f\, \dd \mu = \lim_{n \to \infty} \int_\Omega [f]_n\, \dd \mu.
\]	
\end{problem}


\section{Additivity of the Lebesgue integral of nonnegative functions}

\begin{proposition}[Additivity of the Lebesgue integral of nonnegative functions]
	\label{pr:additivity-integral-nonneg}
	Let $f$, $g$ be two nonnegative measurable functions. Then
	\[
		\int_\Omega (f + g)\, \dd \mu = \int_\Omega f\, \dd \mu + \int_\Omega g\, \dd \mu.
	\]	
\end{proposition}
\begin{proof}
	For simple functions, the additivity of the integral is easy to check. Therefore for every $n \in \mathbb{N}$,
	\[
	\int_\Omega ([f]_n + [g]_n)\, \dd \mu = \int_\Omega [f]_n\, \dd \mu + \int_\Omega [g]_n\, \dd \mu.
	\]
	We now take the limit on both sides of the equation. On one hand, the functions $[f]_n + [g]_n$ are increasing in $n$, and converge pointwise to $(f + g)$. By the monotone convergence theorem,
	\[
	\lim_{n \to \infty} \int_\Omega ([f]_n + [g]_n)\, \dd \mu = 
	\int_\Omega ( f + g)\, \dd \mu.
	\]
	On the other hand, by a limit theorem and Problem~\ref{prb:simple-approx-integral}, we know that 
	\[
	\lim_{n \to \infty} \left( \int_\Omega [f]_n\, \dd \mu + \int_\Omega [g]_n\, \dd \mu \right) = \int_\Omega f\, \dd \mu + \int_\Omega g\, \dd \mu.
	\]
	Therefore,
	\[
	\int_\Omega (f + g)\, \dd \mu = \int_\Omega f\, \dd \mu + \int_\Omega g\, \dd \mu.\qedhere
	\]
\end{proof}


\section{Integrable functions}\label{sec:integrable}

The next goal is to define the integral of functions $f$ that are not necessarily nonnegative. We can only do this if the integral of $|f|$ is finite.

\begin{definition}
	A measurable function $f: \Omega \to \bbR$ is $\mu$-\emph{integrable} if 
	\[
	\int_\Omega |f|\, \dd \mu < +\infty.	
	\]
	For any function $f: \Omega \to \overline{\bbR}$, we define its \emph{positive part} $f^+$ and \emph{negative part} $f^-$ as
\[
	f^+(\omega) := \max( f(\omega), 0 ),\qquad 
	f^-(\omega) := - \min( f(\omega), 0 ) 
\]
It follows that $f = f^+ - f^-$ and $|f| = f^+ + f^-$.

	The \emph{Lebesgue integral} of a $\mu$-integrable function $f: \Omega \to \bbR$ is
	\[
		\int_\Omega f\,\dd \mu := \int_\Omega f^+\, \dd \mu - \int_\Omega f^-\, \dd \mu.
	\]
\end{definition}

\begin{proposition}
	Let $f$, $g$ be two $\mu$-integrable functions and $\alpha \in \bbR$ be a constant.
	\begin{enumerate}
		\item (Absolute continuity) If $B \in \cF$ satisfies $\mu(B) = 0$, then
		\[
		\int_{B} f\, \dd \mu = 0. 
		\]
		\item (Monotonicity) If $f \leq g$ $\mu$-a.e., then
		\[
		\int_\Omega f \,\dd \mu \leq \int_\Omega g \,\dd \mu.
		\]
		\item (Homogeneity) 
		\[
		\alpha \int_\Omega f \,\dd \mu = \int_\Omega (\alpha f )\,\dd \mu.
		\]
		\item (Additivity)
		\[
		\int_\Omega (f + g)\, \dd \mu = \int_\Omega f 
		\,\dd \mu + \int_\Omega g \,\dd \mu.
		\]	
	\end{enumerate}
\end{proposition}

\begin{definition}
We say that a measurable function $f:(\Omega, \cF) \to (\bbR, \mathcal{B}_\bbR)$ is integrable on a set $A \in \cF$ if the function $\mathbf{1}_A f$ is integrable on $\Omega$. Equivalently, we say that $f$ is integrable on $A$ if the restriction $f|_A$ is integrable on the measure space $(A, \cF_A, \mu|_A)$. 
\end{definition}
	
\section{Change of variables formula}
\label{sec:change-of-variables}

\begin{proposition}
Let $(\Omega, \cF, \mu)$ be a measure space, $f: (\Omega, \cF) \to (E, \mathcal{G})$ and $h: (E, \mathcal{G}) \to ([0,\infty], \mathcal{B}_{[0,\infty]})$ be measurable maps. Then
\[
\int_\Omega h \circ f\,\dd \mu = \int_E h \, \dd (f_\# \mu).
\]
\end{proposition}

\begin{proof}
We first show the statement when $h$ is simple and nonnegative, i.e.,
\[
h = \sum_{i=1}^N a_i \mathbf{1}_{A_i}
\]
for some $N \in \mathbb{N}$, $a_i \in (0,\infty)$, and $A_i \in \cF$ mutually disjoint. Then 
\[
	h \circ f = \sum_{i=1}^N a_i  \mathbf{1}_{f^{-1}(A_i)}.
\]
It follows that
\[
\begin{split}
\int_\Omega h \circ f\, \dd \mu 
= \sum_{i=1}^N a_i \, \mu(f^{-1}(A_i)) 
= \sum_{i=1}^N a_i \, (f_\# \mu)(A_i) 
= \int_E h \, \dd (f_\# \mu),
\end{split}
\]
which shows the proposition in the case when $h$ is simple and nonnegative. 

We now turn to the case in which $h$ is a general, nonnegative measurable function. Note that $[h]_n \circ f$ is a nondecreasing sequence of functions, which converges pointwise to $h \circ f$. By the monotone convergence theorem,
\[
\int_\Omega h \circ f\, \dd \mu 
= \lim_{n \to \infty} \int_\Omega [h]_n \circ f\, \dd \mu 
= \lim_{n \to \infty} \int_E [h]_n \, \dd (f_\# \mu) 
= \int_E h \, \dd (f_\# \mu).\qedhere
\]
\end{proof}

\bigskip

As a direct consequence, we have the following proposition.
\begin{proposition}
Let $(\Omega, \cF, \mu)$ be a measure space, $f: (\Omega, \cF) \to (E, \mathcal{G})$ and $h: (E, \mathcal{G}) \to (\bbR,\mathcal{B})$ be measurable maps. Then $h \circ f$ is integrable with respect to $\mu$ if and only if $h$ is integrable with respect to $f_\# \mu$, in which case,
\[
\int_\Omega h \circ f\, \dd \mu = \int_E h \, \dd (f_\# \mu).
\]
\end{proposition}

\begin{example}
Let $(\Omega, \cF, \mathbb{P})$ be a probability space and $X: (\Omega, \cF) \to (\bbR, \mathcal{B})$ be a continuous random variable. Assume that the law of $X$ can be represented by a \emph{Lebesgue density function} $\varrho: (\bbR, \mathcal{B}) \to ([0,\infty), \mathcal{B}_{[0,\infty)})$, i.e.\ $X_\# \mathbb{P}$ is the (unique) measure given by
\[
(X_\# \mathbb{P})((a,b]) =\mathbb{P}\left(\bigl\{ \omega \in \Omega : X(\omega) \in (a,b]\bigr\} \right) = 
\int_a^b \varrho \, \dd \lambda.
\]	
Let $h : (\bbR, \mathcal{B}) \to (\bbR, \mathcal{B})$ be a bounded measurable function. Then by the change of variables formula,
\[
	\mathbb{E}[h(X)] = \int_{\bbR} h \, \dd (X_\# \mathbb{P}).
\]
On the other hand, the set function
\[
	\nu: \mathcal{B} \to [0,+\infty],\qquad\nu(A) := \int_A \varrho\, \dd \lambda
\]
is a measure on the Borel $\sigma$-algebra (see exercise). From the uniqueness statement in Theorem~\ref{thm:uniqueness-meas}, we conclude that $\nu = X_\# \mathbb{P}$. For simple functions $g:(\bbR, \mathcal{B}) \to (\bbR, \mathcal{B})$ one can now check that
\[
\int_\bbR g\, \dd \nu = \int_\bbR g \varrho\, \dd \lambda.
\]
By approximating an arbitrary bounded Borel-measurable function $h$ by a sequence of simple functions and applying the \emph{dominated convergence theorem} (see next chapter), we conclude that also for arbitrary bounded measurable functions $h$,
\[
\int_{\bbR} h\, \dd \nu = \int_{\bbR} h \varrho\, \dd \lambda
\]
and thus
\[
\mathbb{E}[h(X)] = \int_{\bbR} h \, \dd (X_\# \mathbb{P}) = \int_{\bbR} h \, \dd \nu = \int_{\bbR} h \varrho \, \dd \lambda.
\]
\end{example}


\section{The Markov inequality}

The following Lemma states the Markov inequality. The trick used in the proof can be used to obtain many similar inequalities.

\begin{lemma}[The Markov inequality]
	Let $(\Omega, \cF, \mu)$ be a measurable space and let $f$ be a $\mu$-integrable function. For any $t>0$,
	\[
	\mu\bigl(\{ \omega \in \Omega : \ |f|(\omega) \geq t \}\bigr) \leq \frac{1}{t} \int_\Omega |f| \,\dd \mu.
	\]
\end{lemma}
\begin{proof} The result follows easily from
	\[
		\int_\Omega |f|\,\dd \mu \ge \int_{\{|f|\ge t\}} |f|\,\dd \mu \ge t\,\mu\bigl(\{|f|\ge t\}\bigr)  \qedhere
	\]
\end{proof}


In probability language, the Markov inequality looks as follows.

\begin{lemma}[The Markov inequality]
	Let $(\Omega, \cF, \mathbb{P})$ be a probability space and let $X$ be a random variable. For any $t>0$,
	\[
	\mathbb{P}(|X| \geq t) \leq \frac{1}{t} \mathbb{E}[|X|].
	\]
\end{lemma}

